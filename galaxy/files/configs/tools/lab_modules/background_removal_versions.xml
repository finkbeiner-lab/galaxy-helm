<tool id="correct_bg_versions" name="Correct Background">
<description>Divide Median Values</description>

<command interpreter="python">
#if str($process_mode) == 'multiprocessing': 
	background_removal_mp.py
#else:
	background_removal_distributed.py
#end if	
#if str($background_well) !='': 
   --chosen_bg_well '$background_well'
#end if

$infile $input_image_path $output_results_path $qc_path $background_removal_type $outfile 
</command>

<inputs>
<param name="infile" type="data" format="data" label="Local variables dictionary (output from 'Create Folders')."/>
<param name="process_mode" type="select" label="Select a processing mode" help="Multiprocessing use all the cores in one node while Distributed use all the cores in all nodes in the cluster">
            <option value="multiprocessing" selected='true'>MultiProcessing</option>
            <option value="distributed">Distributed</option>
</param>
<param name="input_image_path" type="text" format="text" value="/finkbeiner/imaging/smb-robodata/your_folders/Raw" size="70" label="Enter path to raw data." help="Note that RoboData/your_folders = /finkbeiner/imaging/smb-robodata/your_folders/Raw"/>
<param name="output_results_path" type="text" format="text" value="/finkbeiner/imaging/smb-robodata/your_folders/BackgroundCorrected" size="70" label="Enter path to output destination. Example: BackgroundCorrected" help="Note that RoboData/your_folders = /finkbeiner/imaging/smb-robodata/your_folders"/>
<param name="qc_path" type="text" format="text" value="/finkbeiner/imaging/smb-robodata/your_folders/QualityControl" size="70" label="Enter path to output background quality control images. Example: QualityControl" help="Note that RoboData/your_folders = /finkbeiner/imaging/smb-robodata/your_folders"/>
<param name="background_removal_type" type="select" label="Select removal type" help="Division tends to work better visually for montage. Choose subtraction for quantitavie pixel analysis downstream. The generated background image is a median image of all panels in the well. When negative values arise in subtraction, they are set to zero.">
            <option value="division" selected="true"  >Division</option>
            <option value="subtraction"               >Subtraction</option>
</param>
<param name="background_well" type="text" format="text" value="" size="70" label="Optional: Enter the well used as background for subtraction. If provided, last removal type option will be ignored." help="e.g., A1" optional="true"/>
</inputs>

<outputs>
<data name="outfile" type="data" format="data" label="Background Correction Result"/>
</outputs>

<help>
Calculates a median value from all panels belonging to a montaged image.
Creates a median-valued image.
Subtracts median image from each image to be corrected.
Divides by median image. Resets values to 16-bit.
If microscope background image is given, will use it to subtract from signal.
</help>
</tool>