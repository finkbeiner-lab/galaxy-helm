<tool id="plate_montage" name="Plate Montage:" version="0.01">

<description>Makes Montages of Multiple Wells.</description>

<command>
source /finkbeiner/imaging/home/fbgalaxy/.virtualenvs/insilico/bin/activate; 
/finkbeiner/imaging/home/fbgalaxy/.virtualenvs/insilico/bin/python3.6 /finkbeiner/imaging/home/galaxy/tools/dev_staging_modules/plate_montage.py $input_var_dict $img_size $crop_factor $norm_intensity $keep_blanks $outfile

#if $images_path != '':
   --images_path '$images_path'
#end if
#if $output_path != '':
   --output_path '$output_path'
#end if
</command>

<inputs>
<param name="input_var_dict" type="data" format="data" label="Local variables dictionary (e.g. output from 'Alignment')"/>

<param name="img_size" type="text" format="text" size="70" value="500" label="Target image size"
 help="Enter the image size, in pixels (along one dimension), to downsize each image to. For example, if the each image of the montage should be 500x500, enter 500."/>

<param name="crop_factor" type="text" format="text" size="70" value="1" label="Crop factor"
 help="Enter the factor (e.g. 1.2) by which each image should be cropped (i.e. zoomed) before assembling the montage. This will exclude edges of the well,
 but allows more detail to be seen, especially with smaller image sizes. Set crop factor to 1 for no cropping."/>

<param name="norm_intensity" type="text" format="text" size="70" value="0" label="Pixel intensity for normalization"
help="Enter an intensity value that all images will be normalized to. Note that any value less than the max pixel intensity will saturate pixels, which can improve the display but should not be used for analysis. Keep value as 0 to normalize to the calculated max pixel intensity"/>

<param name="keep_blanks" type="select" display="select" label="Select whether or not to keep empty rows or columns"
 help="Select whether to keep or remove rows or columns that have no images. E.g. if rows A and C have images but B doesn't, selecting 'remove' will exclude row B from the montage. Note that this only applies to rows/columns that are in betweeen other rows/column with images.  ">
    <option value="True" selected="true">Keep rows/columns with no images</option>
    <option value="False">Remove rows/columns with no images</option>
</param>

<param name="images_path" type="text" format="text" value="" size="70" label="Optional: Enter path to images (e.g. AlignedImages)."
help="Leave blank to get from AlignedImages folder in Galaxy output folder, or enter path to images to be stacked, e.g. /finkbeiner/imaging/smb-robodata/your_folders/AlignedImages" optional='true'/>

<param name="output_path" type="text" format="text" value="" size="70" label="Optional: Enter output path."
help="Leave blank to save to PlateMontages folder in Galaxy output folder, or enter path to where montages should be saved, e.g. /finkbeiner/imaging/smb-robodata/your_folders/PlateMontages. This folder will be created if it doesn't already exist." optional='true'/>
</inputs>

<outputs>
<data name="outfile" type="data" format="data" label="Plate Montage"/>
</outputs>

<help>
Generates plate montages.
</help>

</tool>
